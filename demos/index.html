<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Viewprt</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <h1>
      Viewprt (PositionObserver: body)
      <button onclick="bodyPosObserver.destroy()">Destroy</button>
      <button onclick="bodyPosObserver.activate()">Activate</button>
    </h1>

    <div id="verticalPane">
      <h3>
        An container with vertical overflow
        <button onclick="verticalPanePosObserver.destroy()">Destroy</button>
        <button onclick="verticalPanePosObserver.activate()">Activate</button>
      </h3>
      <div class="dummyContent"></div>
      <div id="elementInVerticalPane" class="block">
        <h3>Element</h3>
        <button onclick="elementInVerticalPaneObserver.destroy()">Destroy</button>
        <button onclick="elementInVerticalPaneObserver.activate()">Activate</button>
      </div>
      <div class="dummyContent"></div>
    </div>

    <div id="horizontalPane">
      <h3>
        An container with horizontal overflow
        <button onclick="horizontalPanePosObserver.destroy()">Destroy</button>
        <button onclick="horizontalPanePosObserver.activate()">Activate</button>
      </h3>
      <div class="dummyContent"></div>
      <div id="elementInHorizontalPane" class="block">
        <h3>Element</h3>
        <button onclick="elementInHorizontalPaneObserver.destroy()">Destroy</button>
        <button onclick="elementInHorizontalPaneObserver.activate()">Activate</button>
      </div>
      <div class="dummyContent"></div>
    </div>

    <div id="elementInBody" class="block">
      <h3>
        Element
        <button onclick="moveElementInBody()">Move</button>
        <button onclick="elementInBodyObserver.destroy()">Destroy</button>
        <button onclick="elementInBodyObserver.activate()">Activate</button>
      </h3>
    </div>
    
    <div class="dummyContent"></div>

    <script>
      // Demo setup: create some dummy content
      function createDummyEl (text) {
        var el = document.createElement('p')
        el.appendChild(document.createTextNode(text))
        return el
      }

      function addDummyContentTo (el) {
        for (var i = 0; i < 50; i++) {
          el.appendChild(createDummyEl(i))
        }
      }

      function moveElementInBody() {
        const elementInBody = document.getElementById('elementInBody')
        document.body.appendChild(elementInBody)
      }

      const dummyEls = document.getElementsByClassName('dummyContent')
      ;[].forEach.call(dummyEls, addDummyContentTo)
    </script>

    <!-- 
      Use the published version so this works remotely,
      but override with local build if available, for testing purposes.
    -->
    <script src="https://unpkg.com/viewprt"></script>
    <script src="../dist/viewprt.umd.js"></script>

    <script>
      var PositionObserver = viewprt.PositionObserver
      var ElementObserver = viewprt.ElementObserver
      var blue = '#42A5F5'
      var green = '#66BB6A'

      function onBottom (element, viewportState) {
        element.style.borderColor = green
        console.log(element.id ? element.id : element.tagName.toLowerCase(), 'reached bottom', viewportState)
      }
      function onTop (element, viewportState) {
        element.style.borderColor = blue
        console.log(element.id ? element.id : element.tagName.toLowerCase(), 'reached top', viewportState)
      }
      function onLeft (element, viewportState) {
        element.style.borderColor = green
        console.log(element.id ? element.id : element.tagName.toLowerCase(), 'reached left', viewportState)
      }
      function onRight (element, viewportState) {
        element.style.borderColor = blue
        console.log(element.id ? element.id : element.tagName.toLowerCase(), 'reached right', viewportState)
      }
      function onEnter(element, viewportState) {
        element.style.backgroundColor = green
        console.log('Entered viewport', viewportState)
      }
      function onExit(element, viewportState) {
        element.style.backgroundColor = blue
        console.log('Exited viewport', viewportState)
      }

      var bodyPosObserver = PositionObserver({
        onBottom: onBottom,
        onTop: onTop
      })

      var verticalPanePosObserver = PositionObserver({
        container: document.getElementById('verticalPane'),
        onBottom: onBottom,
        onTop: onTop
      })

      var horizontalPanePosObserver = PositionObserver({
        container: document.getElementById('horizontalPane'),
        onLeft: onLeft,
        onRight: onRight
      })

      var elementInBodyObserver = ElementObserver(document.getElementById('elementInBody'), {
        onEnter: onEnter,
        onExit: onExit
      })

      var elementInVerticalPaneObserver = ElementObserver(document.getElementById('elementInVerticalPane'), {
        container: document.getElementById('verticalPane'),
        onEnter: onEnter,
        onExit: onExit
      })

      var elementInHorizontalPaneObserver = ElementObserver(document.getElementById('elementInHorizontalPane'), {
        container: document.getElementById('horizontalPane'),
        onEnter: onEnter,
        onExit: onExit
      })
    </script>
  </body>
</html>
